<?xml version='1.0' encoding='utf-8'?>

<!-- Copyright (C) 2017 Swiss Library for the Blind, Visually Impaired and Print Disabled -->

<!-- This file is part of dtbook2sbsform. -->

<!-- dtbook2sbsform is free software: you can redistribute it -->
<!-- and/or modify it under the terms of the GNU Lesser General Public -->
<!-- License as published by the Free Software Foundation, either -->
<!-- version 3 of the License, or (at your option) any later version. -->

<!-- This program is distributed in the hope that it will be useful, -->
<!-- but WITHOUT ANY WARRANTY; without even the implied warranty of -->
<!-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU -->
<!-- Lesser General Public License for more details. -->

<!-- You should have received a copy of the GNU Lesser General Public -->
<!-- License along with this program. If not, see -->
<!-- <http://www.gnu.org/licenses/>. -->

<!DOCTYPE utfx:tests PUBLIC "-//UTF-X//DTD utfx-tests 1.0//EN" "utfx_tests.dtd">
<utfx:tests xmlns:utfx="http://utfx.org/test-definition"
  xmlns:dtb="http://www.daisy.org/z3986/2005/dtbook/"
  xmlns:brl="http://www.daisy.org/z3986/2009/braille/">
  <utfx:stylesheet src="xsl/dtbook2sbsform.xsl"/>

  <utfx:test>
    <utfx:name>Falsche Kursiv-Ankündigung beim Gebrauch von nbsp statt gewöhnlichem Leerzeichen, http://redmine.sbszh.ch/issues/2625</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<dtb:p xml:lang="de"><dtb:em>bla&#160;blo</dtb:em></dtb:p>
      </utfx:source>
      <utfx:expected>
y P
 __BLA BLO'.</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Fälschlicherweise Leerzeile in SBSForm-Code bei aufeinanderfolgenden PAGENUM mit A, http://redmine.sbszh.ch/issues/2470</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<dtb:p xml:lang="de"> bla <dtb:pagenum id="page-10" page="normal">10</dtb:pagenum><dtb:a id="p-10"/>
	<dtb:pagenum id="page-11" page="normal">11</dtb:pagenum><dtb:a id="p-11"/> blo </dtb:p>
      </utfx:source>
      <utfx:expected>
y P
  BLA 
j 10 
j 11
  BLO
      </utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>aufeinanderfolgende PAGENUMs</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<dtb:p xml:lang="de">
	  <dtb:pagenum id="page-10" page="normal">10</dtb:pagenum>
	  
	  <dtb:pagenum id="page-11" page="normal">11</dtb:pagenum>
	</dtb:p>
      </utfx:source>
      <utfx:expected>
y P
  
j 10 
j 11

      </utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>aufeinanderfolgende PAGENUMs</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<dtb:p xml:lang="de">
	  <dtb:pagenum id="page-10" page="normal">10</dtb:pagenum>

	  Foo

	  <dtb:pagenum id="page-11" page="normal">11</dtb:pagenum>
	</dtb:p>
      </utfx:source>
      <utfx:expected>
y P
  
j 10
  FOO 
j 11

      </utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Falsche Übersetzungen bei mixed emphasis, http://redmine.sbszh.ch/issues/2464</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<stub xml:lang="de">
	  <dtb:p><dtb:em>experimental</dtb:em>protektorverhalten</dtb:p>
	  <dtb:p>experimental<dtb:em>protektor</dtb:em>verhalten</dtb:p>
	  <dtb:p>experimentalprotektor<dtb:em>verhalten</dtb:em></dtb:p>
	</stub>
      </utfx:source>
      <utfx:expected>
y P
 _XP7IMCT:'.PRO(KT?V7H:TC
y P
 XP7IMCT:'_PRO(KT?'.V7H:TC
y P
 XP7IMCT:PRO(KT?'_V7H:TC
      </utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Pfeilsymbole erscheinen fälschlicherweise IMMER mit Leerzeichen davor und dahinter, http://redmine.sbszh.ch/issues/2456</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<stub xml:lang="de">
	  <dtb:p> Abgase → Umweltverschmutzung </dtb:p>
	  <dtb:p> Siehe Kapitel 3 (→ Kaufvertrag) </dtb:p>
	</stub>
      </utfx:source>
      <utfx:expected>
y P
  ABGASE ::O UMWYTV75MUTZU 
y P
  S0HE KAPITY #C =::O K1FV7TG=
      </utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Automatische Korrektur des Abstands zwischen Operator und Zahl, http://redmine.sbszh.ch/issues/2326</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<dtb:p xml:lang="de">Kaufpreis × 4</dtb:p>
      </utfx:source>
      <utfx:expected>
y P
 K1FPR3S "(#D
      </utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Plus</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<stub xml:lang="de">222 + 222 222+222 222 +222 wort + wort wort + 222</stub>
      </utfx:source>
      <utfx:expected>#BBB "+#BBB #BBB "+#BBB #BBB "+#BBB W?T "+ W?T W?T "+#BBB</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Minus</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<stub xml:lang="de">222 &#x2212; 222 222&#x2212;222 222 &#x2212;222 wort &#x2212; wort wort &#x2212; 222</stub>
      </utfx:source>
      <utfx:expected>#BBB "-#BBB #BBB "-#BBB #BBB "-#BBB W?T "- W?T W?T "-#BBB</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Malkreuz</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<stub xml:lang="de">222 × 222 222×222 222 ×222 wort × wort wort × 222</stub>
      </utfx:source>
      <utfx:expected>#BBB "(#BBB #BBB "(#BBB #BBB "(#BBB W?T "( W?T W?T "(#BBB</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Geteilt durch</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<stub xml:lang="de">222 ÷ 222 222÷222 222 ÷222 wort ÷ wort wort ÷ 222</stub>
      </utfx:source>
      <utfx:expected>#BBB ":#BBB #BBB ":#BBB #BBB ":#BBB W?T ": W?T W?T ":#BBB</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Gleich</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<stub xml:lang="de">222 = 222 222=222 222 =222 wort = wort wort = 222</stub>
      </utfx:source>
      <utfx:expected>#BBB "=#BBB #BBB "=#BBB #BBB "=#BBB W?T "= W?T W?T "=#BBB</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Fehlender Punkt 6 Apo bei Frage-/Ausrufezeichen in Klammern, http://redmine.sbszh.ch/issues/2324</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<dtb:p xml:lang="de">(?) (!)</dtb:p>
      </utfx:source>
      <utfx:expected>
y P
 ='?= ='+=
      </utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Korrektur des Trademark-Symbols, http://redmine.sbszh.ch/issues/2270</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<stub xml:lang="de">foo™</stub>
      </utfx:source>
      <utfx:expected>FOO'=>TM=</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Falsche Übersetzung bei Wörtern mit Stern `*`, http://redmine.sbszh.ch/issues/2187</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<stub xml:lang="de">
	  <dtb:p>Martell</dtb:p>
	  <dtb:p>Martell*</dtb:p>
	</stub>
      </utfx:source>
      <utfx:expected>
y P
 M)(Q
y P
 M)(Q'*
      </utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>Fragezeichen nach Klammer fälschlicherweise ohne Pt. 6 Apo, http://redmine.sbszh.ch/issues/2186</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<stub xml:lang="de">
	  <dtb:p>bla (45-55) blo</dtb:p>
	  <dtb:p>bla ?-55 blo</dtb:p>
	  <dtb:p>bla (?-55) blo</dtb:p>
	</stub>
      </utfx:source>
      <utfx:expected>
y P
 BLA =#DE-#EE'= BLO
y P
 BLA '?-#EE BLO
y P
 BLA ='?-#EE'= BLO
      </utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

  <utfx:test>
    <utfx:name>falsches Resultat bei Wortersatzstrich -xxx, wenn direkt nach Tag, http://redmine.sbszh.ch/issues/1505</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
	<stub xml:lang="de">
	  <dtb:p>-losenheim</dtb:p>
	</stub>
      </utfx:source>
      <utfx:expected>
y P
 '-LOSCH3M
      </utfx:expected>
    </utfx:assert-equal>
  </utfx:test>

</utfx:tests>
