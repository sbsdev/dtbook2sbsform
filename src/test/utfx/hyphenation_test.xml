<?xml version='1.0' encoding='utf-8'?>

<!-- Copyright (C) 2010 Swiss Library for the Blind, Visually Impaired and Print Disabled -->

<!-- This file is part of dtbook2sbsform. -->

<!-- dtbook2sbsform is free software: you can redistribute it -->
<!-- and/or modify it under the terms of the GNU Lesser General Public -->
<!-- License as published by the Free Software Foundation, either -->
<!-- version 3 of the License, or (at your option) any later version. -->

<!-- This program is distributed in the hope that it will be useful, -->
<!-- but WITHOUT ANY WARRANTY; without even the implied warranty of -->
<!-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU -->
<!-- Lesser General Public License for more details. -->

<!-- You should have received a copy of the GNU Lesser General Public -->
<!-- License along with this program. If not, see -->
<!-- <http://www.gnu.org/licenses/>. -->

<!DOCTYPE utfx:tests PUBLIC "-//UTF-X//DTD utfx-tests 1.0//EN" "utfx_tests.dtd">
<utfx:tests xmlns:utfx="http://utfx.org/test-definition"
  xmlns:dtb="http://www.daisy.org/z3986/2005/dtbook/"
  xmlns:brl="http://www.daisy.org/z3986/2009/braille/">
  <utfx:stylesheet src="xsl/dtbook2sbsform.xsl"/>

  <utfx:test>
    <utfx:name>Test handling of pre-hyphenated text</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
      <utfx:with-param name="hyphenation" select="true()"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
        <dtb:p xml:lang="de">Ba­de­ho­sen­bun­des</dtb:p>
      </utfx:source>
      <utfx:expected>
y P
 BAtDEtHOtSCtB/tD%</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>
  
  <utfx:test>
    <utfx:name>Test handling of pre-hyphenated text in doctitle</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
      <utfx:with-param name="hyphenation" select="true()"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
        <dtb:doctitle xml:lang="de">Ba­de­ho­sen­bun­des</dtb:doctitle>
      </utfx:source>
      <utfx:expected>BAtDEtHOtSCtB/tD%</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>
  
  <utfx:test>
    <utfx:name>Pre-hyphenation grade 0</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="0"/>
      <utfx:with-param name="hyphenation" select="true()"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
        <dtb:p>>Ba­de­ho­sen­bun­des</dtb:p>
      </utfx:source>
      <utfx:expected>
y P
 "O,BAtDEtHOtSENtBUNtDES</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>
  
  <utfx:test>
    <utfx:name>Hyphenation seems to fail after EM passage (#1693)</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="1"/>
      <utfx:with-param name="hyphenation" select="true()"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
        <stub xml:lang="de"><dtb:p>Car­lo hat­te ihr ein Buch mit­ge­bracht, einen Ge­dicht­band, von sich, mit dem Ti­tel: <dtb:em>Al­les und nichts</dtb:em>, ein Ge­schenk. Sie war ein we­nig zu­sam­men­ge­zuckt. Sie war er­schro­cken. Sie hat­te kein Ge­schenk für ihn da­bei. Höf­lich hat­te sie dar­in ge­blät­tert. Sie hat­te sich be­dankt. Dass sie Ge­dich­te lie­be, hat­te sie ihm ver­si­chert. Für sich hat­te sie aber ge­dacht, dass sie schreck­lich sein wür­den, sei­ne Ge­dich­te, be­stimmt. Sie hat­te Angst da­vor, es ihm sa­gen zu müs­sen. Trotz­dem, es wä­re ihr lie­ber ge­we­sen. Sie wer­de sie le­sen, bald, sag­te sie ihm.</dtb:p></stub>
      </utfx:source>
      <utfx:expected>
y P
 CARtLO HATtTE IHR 3N BU4 MITtGEtBRA4T, 3NEN GEtDI4TtBAND, VON SI4, MIT DEM TItTEL: __ALtLES UND NI4TS'., 3N GEt5ENK. S0 WAR 3N WEtNIG ZUtSAMtMENtGEtZUCKT. S0 WAR ERt5ROtCKEN. S0 HATtTE K3N GEt5ENK F8R IHN DAtB3. H9FtLI4 HATtTE S0 DARtIN GEtBL@TtTERT. S0 HATtTE SI4 BEtDANKT. DASS S0 GEtDI4tTE L0tBE, HATtTE S0 IHM VERtSIt4ERT. F8R SI4 HATtTE S0 ABER GEtDA4T, DASS S0 5RECKtLI4 S3N W8RtDEN, S3tNE GEtDI4tTE, BEt]IMMT. S0 HATtTE ANG] DAtVOR, ES IHM SAtGEN ZU M8StSEN. TROTZtDEM, ES W@tRE IHR L0tBER GEtWEtSEN. S0 WERtDE S0 LEtSEN, BALD, SAGtTE S0 IHM.</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>
  
  <utfx:test>
    <utfx:name>falsche Trennmarke m nach Vorsilbe ver... (-...) (#1754)</utfx:name>
    <utfx:stylesheet-params>
      <utfx:with-param name="contraction" select="2"/>
      <utfx:with-param name="hyphenation" select="true()"/>
    </utfx:stylesheet-params>
    <utfx:assert-equal>
      <utfx:source>
        <stub xml:lang="de">
          <dtb:p>ver­stopfen</dtb:p>
          <dtb:p>ver­stopf­bar</dtb:p>
        </stub>
      </utfx:source>
      <utfx:expected>
y P
 -t]OPFC
y P
 -t]OPFtBAR</utfx:expected>
    </utfx:assert-equal>
  </utfx:test>
  
</utfx:tests>
